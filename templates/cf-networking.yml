meta:
  networks:
    ipmask: (( merge || "10.10" ))
    dns: (( merge || nil ))
    security_groups: (( merge || nil ))
  
    cf1:
      quad: (( merge || "1" ))
      net_id: (( merge ))
      subnet: (( net_id ))
      range: (( merge || defaults.cf1.range ))
      gateway: (( merge || defaults.cf1.gateway ))
      dns: (( merge || meta.networks.dns ))
      reserved: (( merge || defaults.cf1.reserved ))
      static: (( merge || defaults.cf1.static ))
      security_groups: (( merge || meta.networks.security_groups ))
      availability_zone: (( merge || nil ))

    cf2:
      quad: (( merge || "2" ))
      net_id: (( merge ))
      subnet: (( net_id ))
      range: (( merge || defaults.cf2.range ))
      gateway: (( merge || defaults.cf2.gateway ))
      dns: (( merge || meta.networks.dns ))
      reserved: (( merge || defaults.cf2.reserved ))
      static: (( merge || defaults.cf2.static ))
      security_groups: (( merge || meta.networks.security_groups ))
      availability_zone: (( merge || nil ))

defaults:
  cf1:
    net: (( meta.networks.ipmask "." meta.networks.cf1.quad ))
    range: (( defaults.cf1.net ".0/24" ))
    gateway: (( defaults.cf1.net ".1" ))
    reserved:
      - (( defaults.cf1.net ".2 - " defaults.cf1.net ".5" ))
    static:
      - (( defaults.cf1.net ".6 - " defaults.cf1.net ".50" ))

  cf2:
    net: (( meta.networks.ipmask "." meta.networks.cf2.quad ))
    range: (( defaults.cf2.net ".0/24" ))
    gateway: (( defaults.cf2.net ".1" ))
    reserved:
      - (( defaults.cf2.net ".2 - " defaults.cf2.net ".5" ))
    static:
      - (( defaults.cf2.net ".6 - " defaults.cf2.net ".50" ))

  # expose 10.10.5.0-10.255.255.255 for services
properties:
  cc:
    security_group_definitions:
    - name: public_networks
      rules:
       - protocol: all
         destination: 0.0.0.0-9.255.255.255
       - protocol: all
         destination: 10.10.5.0-169.253.255.255
       - protocol: all
         destination: 169.255.0.0-172.15.255.255
       - protocol: all
         destination: 172.32.0.0-192.167.255.255
       - protocol: all
         destination: 192.169.0.0-255.255.255.255
    - name: dns
      rules:
       - protocol: tcp
         destination: 0.0.0.0/0
         ports: '53'
       - protocol: udp
         destination: 0.0.0.0/0
         ports: '53'


networks:
  - name: cf1
    type: manual
    subnets:
      - name: default_unused
        range: (( meta.networks.cf1.range ))
        reserved: (( meta.networks.cf1.reserved ))
        static: (( meta.networks.cf1.static ))
        gateway: (( meta.networks.cf1.gateway ))
        dns: (( meta.networks.cf1.dns ))
        cloud_properties:
          security_groups: (( meta.networks.cf1.security_groups ))
          subnet: (( meta.networks.cf1.net_id ))
          net_id: (( meta.networks.cf1.net_id ))
          availability_zone: (( meta.networks.cf1.availability_zone ))

  - name: cf2
    type: manual
    subnets:
      - name: default_unused
        range: (( meta.networks.cf2.range ))
        reserved: (( meta.networks.cf2.reserved ))
        static: (( meta.networks.cf2.static ))
        gateway: (( meta.networks.cf2.gateway ))
        dns: (( meta.networks.cf2.dns ))
        cloud_properties:
          security_groups: (( meta.networks.cf2.security_groups ))
          subnet: (( meta.networks.cf2.net_id ))
          net_id: (( meta.networks.cf2.net_id ))
          availability_zone: (( meta.networks.cf2.availability_zone ))

  - name: floating
    type: vip
    cloud_properties: {}
